<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neff Enterprises Tool Suite - Resources</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-dark': '#1f2937', // Gray-800
                        'accent': '#059669', // Vibrant Emerald Green
                        'nav-dark': '#0f172a', // Deep Charcoal/Navy (NavBar background)
                        'nav-text': '#f3f4f6', // Light gray/White for navbar text
                        'active-yellow': '#f59e0b', // Specific yellow/gold color (f59e0b) - Used for active Resources and hover state
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for better mobile experience */
        body {
            background-color: #f3f4f6;
            padding-top: 64px; /* Ensure padding at the top to clear the fixed navigation bar */
        }
        .card {
            /* Adjusted shadow for the individual tool containers */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* Style for custom radio buttons/checkboxes */
        .configuration-group input[type="radio"] {
            display: none; /* Hide default radio input */
        }
        .configuration-group .custom-radio-label {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .configuration-group .custom-radio-label:hover {
             border-color: #d1d5db; /* Slightly darker gray border on hover */
        }
        
        .configuration-group .custom-radio-label:active {
            transform: scale(0.98);
        }
        /* --- Final Checked State (Very Dark Gray Fill) --- */
        .configuration-group input[type="radio"]:checked + .custom-radio-label {
            border-color: #059669; /* Keep the Accent color border */
            background-color: #374151; /* Dark Gray Fill */
            color: #ffffff; /* White text for maximum contrast */
            box-shadow: 0 1px 3px rgba(5, 150, 105, 0.4);
        }
        .configuration-group input[type="radio"]:checked + .custom-radio-label span {
            color: #ffffff; 
        }
    </style>
</head>
<body class="font-sans min-h-screen">
    
    <!-- TOP NAVIGATION BAR -->
    <header id="top-nav" class="fixed top-0 left-0 right-0 z-50 bg-nav-dark shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <a href="index.html" class="text-2xl font-bold text-nav-text hover:text-active-yellow transition duration-150">
                        Neff Enterprises
                    </a>
                </div>
                <nav class="hidden md:flex space-x-6 items-center">
                    <!-- Note: This link now points to itself and is styled as active -->
                    <a href="resources.html" class="bg-active-yellow text-nav-dark font-bold px-4 py-2 rounded-lg shadow-md hover:bg-yellow-500 transition duration-150">
                        Resources
                    </a>
                    <a href="newCabinets.html" class="text-nav-text hover:text-active-yellow font-medium transition duration-150 p-2 rounded-lg">
                        New Cabinets
                    </a>
                    <a href="cabinetCostTool.html" class="text-nav-text hover:text-active-yellow font-medium transition duration-150 p-2 rounded-lg">
                        Rebuild Price Calculator
                    </a>
                </nav>
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-button" class="text-nav-text p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-accent border border-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-nav-dark pb-4 px-2 space-y-1 sm:px-3 border-t border-gray-700">
            <a href="resources.html" class="block px-3 py-2 rounded-md text-base font-bold bg-active-yellow text-nav-dark shadow-md">
                Resources
            </a>
            <a href="newCabinets.html" class="block px-3 py-2 rounded-md text-base font-medium text-nav-text hover:bg-gray-700 hover:text-active-yellow transition duration-150">
                New Cabinets
            </a>
            <a href="cabinetCostTool.html" class="block px-3 py-2 rounded-md text-base font-medium text-nav-text hover:bg-gray-700 hover:text-active-yellow transition duration-150">
                        Rebuild Price Calculator
                    </a>
        </div>
    </header>

    <!-- MAIN TOOL AREA: Contains Collapsible Sections -->
    <div class="p-4 flex justify-center items-start pt-8">
        <div class="w-full max-w-4xl space-y-6">
            <!-- 1. EURO CABINET CUT LIST GENERATOR (Collapsible) -->
            <div class="bg-white rounded-xl shadow-xl">
                <!-- Header (Clickable to Toggle) -->
                <div id="cut-list-header" class="p-6 cursor-pointer flex justify-between items-center bg-gray-100 rounded-t-xl hover:bg-gray-200 transition duration-150">
                    <h1 class="text-2xl font-bold text-primary-dark">Euro Cabinet Cut List Generator</h1>
                    <!-- Down Arrow Icon -->
                    <svg id="cut-list-icon" class="w-6 h-6 text-gray-700 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                
                <!-- Content (Initially Hidden) -->
                <div id="cut-list-content" class="hidden p-6">
                    <p class="text-center text-gray-500 mb-8">Calculate precise dimensions for your frameless (Euro) cabinet components.</p>
            
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Input Panel -->
                        <div class="space-y-6">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Cabinet Specifications</h2>
                            <!-- Material Thickness Selector -->
                            <div class="input-group mb-4">
                                <label for="material-thickness" class="block text-lg font-medium text-gray-700 mb-1">Material Thickness (T)</label>
                                <select id="material-thickness" class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl transition duration-150">
                                    <option value="0.75" selected>3/4" (0.75 in)</option>
                                    <option value="0.625">5/8" (0.625 in)</option>
                                </select>
                                <p class="text-sm text-gray-500 mt-1">This is critical for calculating box width reductions.</p>
                            </div>
                            <!-- Input Fields: Height, Face Height, Depth, Width -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label for="box-height" class="block text-lg font-medium text-gray-700 mb-1">Cabinet Height (A)</label>
                                    <!-- Defaulted to 0.0 -->
                                    <input type="number" id="box-height" value="0.0" min="0" step="0.01" placeholder="34.5"
                                                class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                    <p class="text-sm text-gray-500 mt-1">Overall height of the box.</p>
                                </div>
                                <div class="input-group">
                                    <label for="face-height" class="block text-lg font-medium text-gray-700 mb-1">Face Height (B)</label>
                                    <!-- Defaulted to 0.0 -->
                                    <input type="number" id="face-height" value="0.0" min="0" step="0.01" placeholder="30.5"
                                                class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                    <p class="text-sm text-gray-500 mt-1">Height of the face/door/drawer.</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label for="box-depth" class="block text-lg font-medium text-gray-700 mb-1">Cabinet Depth (C)</label>
                                    <!-- Defaulted to 0.0 -->
                                    <input type="number" id="box-depth" value="0.0" min="0" step="0.01" placeholder="24.0"
                                                class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                    <p class="text-sm text-gray-500 mt-1">Standard 24 or 21 inches.</p>
                                </div>
                                <div class="input-group">
                                    <label for="box-width" class="block text-lg font-medium text-gray-700 mb-1">Cabinet Width (D)</label>
                                    <!-- Defaulted to 0.0 -->
                                    <input type="number" id="box-width" value="0.0" min="0" step="0.01" placeholder="36.0"
                                                class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                    <p class="text-sm text-gray-500 mt-1">Overall width (e.g., 36 inches).</p>
                                </div>
                            </div>
                            
                            <!-- Configuration Selector (New Section) -->
                            <div class="configuration-group border-t pt-6 space-y-2">
                                <label class="block text-xl font-semibold text-accent mb-2">Cabinet Configuration</label>
                                
                                <label class="custom-radio-label">
                                    <input type="radio" name="cabinet-type" value="door_drawer" id="config-door-drawer" checked>
                                    <span class="ml-3 text-lg font-medium text-gray-800">Door + Drawer</span>
                                </label>
                                
                                <label class="custom-radio-label">
                                    <input type="radio" name="cabinet-type" value="full_door" id="config-full-door">
                                    <span class="ml-3 text-lg font-medium text-gray-800">Full Height Doors</span>
                                </label>
                                
                                <label class="custom-radio-label">
                                    <input type="radio" name="cabinet-type" value="drawer_bank" id="config-drawer-bank">
                                    <span class="ml-3 text-lg font-medium text-gray-800">Drawer Bank</span>
                                </label>
                            </div>
                        </div>
                        <!-- Output Panel -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Calculated Cut List</h2>
                            
                            <!-- Cut List Results -->
                            <div id="results-container" class="space-y-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <!-- Sides -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-accent">
                                    <h3 class="text-lg font-bold text-primary-dark">Sides (2x)</h3>
                                    <p class="text-2xl font-extrabold text-accent" id="cut-side-dims">0" x 0"</p>
                                </div>
                                <!-- Bottom (1x) -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-blue-500">
                                    <h3 class="text-lg font-bold text-primary-dark">Bottom (1x)</h3>
                                    <p class="text-2xl font-extrabold text-blue-500" id="cut-bottom-dims-actual">0" x 0"</p>
                                </div>
                                
                                <!-- Stretchers (Nx) -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-indigo-500">
                                    <h3 class="text-lg font-bold text-primary-dark" id="stretcher-count-title">Stretchers (5x)</h3>
                                    <p class="text-2xl font-extrabold text-indigo-500" id="cut-stretcher-dims">0" x 0"</p>
                                </div>
                                <!-- Back Panel -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-red-500">
                                    <h3 class="text-lg font-bold text-primary-dark">Back Panel (1x)</h3>
                                    <p class="text-2xl font-extrabold text-red-500" id="cut-back-dims">0" x 0.00"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-4 border-t border-gray-200">
                        <p class="text-sm text-gray-500 text-center">All dimensions are in inches (in). Width is always listed first, followed by height/depth.</p>
                    </div>
                </div>
            </div>
            
            <!-- 2. DRAWER BOX CUT LIST GENERATOR -->
            <div class="bg-white rounded-xl shadow-xl">
                <!-- Header (Clickable to Toggle) -->
                <div id="drawer-box-cut-list-header" class="p-6 cursor-pointer flex justify-between items-center bg-gray-100 rounded-t-xl hover:bg-gray-200 transition duration-150">
                    <h1 class="text-2xl font-bold text-primary-dark">Drawer Box Cut List Generator</h1>
                    <!-- Down Arrow Icon -->
                    <svg id="drawer-box-cut-list-icon" class="w-6 h-6 text-gray-700 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                
                <!-- Content (Initially Hidden) -->
                <div id="drawer-box-cut-list-content" class="hidden p-6">
                    <p class="text-lg text-red-600 font-semibold text-center bg-red-100 p-3 rounded-lg mb-6 shadow-inner">
                        Be sure to dado a 1/4" x 1/4" slit in the edge pieces to slide the 1/4" bottom.
                    </p>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Input Panel -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Drawer Box Dimensions (in)</h2>
                            <div class="input-group">
                                <label for="drawer-box-width" class="block text-lg font-medium text-gray-700 mb-1">Overall Width</label>
                                <input type="number" id="drawer-box-width" value="0.0" min="0" step="0.01" placeholder="18.0"
                                            class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                <p class="text-sm text-gray-500 mt-1">External width of the finished drawer box.</p>
                            </div>
                            <div class="input-group">
                                <label for="drawer-box-depth" class="block text-lg font-medium text-gray-700 mb-1">Overall Depth (Length)</label>
                                <input type="number" id="drawer-box-depth" value="0.0" min="0" step="0.01" placeholder="21.0"
                                            class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                <p class="text-sm text-gray-500 mt-1">External depth/length of the finished drawer box.</p>
                            </div>
                            <div class="input-group">
                                <label for="drawer-box-height" class="block text-lg font-medium text-gray-700 mb-1">Overall Height</label>
                                <input type="number" id="drawer-box-height" value="0.0" min="0" step="0.01" placeholder="6.0"
                                            class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                <p class="text-sm text-gray-500 mt-1">External height of the finished drawer box.</p>
                            </div>
                        </div>
                        <!-- Output Panel -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Drawer Box Cut List</h2>
                            
                            <!-- Cut List Results -->
                            <div class="space-y-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <!-- Sides (2x) -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-accent">
                                    <h3 class="text-lg font-bold text-primary-dark">Sides (2x)</h3>
                                    <p class="text-2xl font-extrabold text-accent" id="drawer-side-dims">0" x 0"</p>
                                </div>
                                <!-- Front & Back (2x) -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-blue-500">
                                    <h3 class="text-lg font-bold text-primary-dark">Front & Back (2x)</h3>
                                    <p class="text-2xl font-extrabold text-blue-500" id="drawer-front-back-dims">0" x 0"</p>
                                </div>
                                
                                <!-- 1/4" Bottom (1x) -->
                                <div class="bg-white p-3 rounded-lg shadow-md border-l-4 border-indigo-500">
                                    <h3 class="text-lg font-bold text-primary-dark">1/4" Bottom (1x)</h3>
                                    <p class="text-2xl font-extrabold text-indigo-500" id="drawer-bottom-dims">0" x 0"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 3. DRAWER REBUILD COST CALCULATOR (Collapsible Section - Now #3) -->
            <div class="bg-white rounded-xl shadow-xl">
                <!-- Header (Clickable to Toggle) -->
                <div id="drawer-cost-header" class="p-6 cursor-pointer flex justify-between items-center bg-gray-100 rounded-t-xl hover:bg-gray-200 transition duration-150">
                    <h1 class="text-2xl font-bold text-primary-dark">Drawer Rebuild Cost Calculator</h1>
                    <!-- Down Arrow Icon -->
                    <svg id="drawer-cost-icon" class="w-6 h-6 text-gray-700 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                
                <!-- Content (Initially Hidden) -->
                <div id="drawer-cost-content" class="hidden p-6">
                    <p class="text-center text-gray-500 mb-8">Calculate the estimated cost for rebuilding a single drawer box.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Inputs -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Drawer Specifications (in)</h2>
                            <div class="input-group">
                                <label for="drawer-width" class="block text-lg font-medium text-gray-700 mb-1">Drawer Width</label>
                                <!-- Defaulted to 0.0 -->
                                <input type="number" id="drawer-width" value="0.0" min="0" step="0.1" placeholder="18.0"
                                            class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                <p class="text-sm text-gray-500 mt-1">Width of the drawer box (in).</p>
                            </div>
                            <div class="input-group">
                                <label for="drawer-depth" class="block text-lg font-medium text-gray-700 mb-1">Drawer Depth (or Length)</label>
                                <!-- Defaulted to 0.0 -->
                                <input type="number" id="drawer-depth" value="0.0" min="0" step="0.1" placeholder="21.0"
                                            class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                <p class="text-sm text-gray-500 mt-1">Depth/Length of the drawer box (in).</p>
                            </div>
                            
                            <!-- Checkbox for Glides (UPDATED in previous step) -->
                            <div class="input-group pt-4 border-t border-gray-200">
                                <label class="flex items-center space-x-3">
                                    <input type="checkbox" id="drawer-new-glides" 
                                           class="form-checkbox h-5 w-5 text-accent rounded focus:ring-accent border-gray-300">
                                    <!-- Price text removed as requested -->
                                    <span class="text-lg font-medium text-gray-700">Needs new set of glides</span>
                                </label>
                                <!-- Descriptive paragraph removed as requested -->
                            </div>
                        </div>
                        
                        <!-- Output -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Calculated Cost</h2>
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h3 class="text-lg font-bold text-primary-dark">Estimated Cost</h3>
                                <p class="text-4xl font-extrabold text-green-600 mt-1" id="calculated-cost">$0.00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 4. FACEFRAME REPAIR COST CALCULATOR (Collapsible Section) -->
            <div class="bg-white rounded-xl shadow-xl">
                <!-- Header (Clickable to Toggle) -->
                <div id="faceframe-repair-header" class="p-6 cursor-pointer flex justify-between items-center bg-gray-100 rounded-t-xl hover:bg-gray-200 transition duration-150">
                    <h1 class="text-2xl font-bold text-primary-dark">Faceframe Repair Cost Calculator</h1>
                    <!-- Down Arrow Icon -->
                    <svg id="faceframe-repair-icon" class="w-6 h-6 text-gray-700 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                
                <!-- Content (Initially Hidden) -->
                <div id="faceframe-repair-content" class="hidden p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Inputs -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Repair Details</h2>
                            <!-- 1. How many sections of face are damaged -->
                            <div class="input-group">
                                <label for="faceframe-sections" class="block text-lg font-medium text-gray-700 mb-1">Sections Damaged</label>
                                <!-- Defaulted to 0 -->
                                <input type="number" id="faceframe-sections" value="0" min="0" step="1" placeholder="1"
                                            class="block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-xl">
                                <p class="text-sm text-gray-500 mt-1">Number of distinct sections (stiles/rails) requiring repair (max 10).</p>
                            </div>
                            <!-- Dynamic Damage Level Selectors will go here (NOW IN A RESPONSIVE 2-COLUMN GRID) -->
                            <div id="damage-level-container" class="pt-4 border-t border-gray-200">
                                <!-- Selectors generated by JavaScript -->
                            </div>
                            <!-- 2. Whole faceframe checkbox (Price text removed) -->
                            <div class="input-group pt-4">
                                <label class="flex items-center space-x-3">
                                    <input type="checkbox" id="faceframe-remade" class="form-checkbox h-5 w-5 text-accent rounded focus:ring-accent border-gray-300">
                                    <span class="text-lg font-medium text-gray-700">Whole faceframe will need remade / sanded + refinished</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Output -->
                        <div class="space-y-4">
                            <h2 class="text-xl font-semibold text-accent border-b pb-2">Estimated Total</h2>
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h3 class="text-lg font-bold text-primary-dark">Estimated Repair Cost</h3>
                                <p class="text-4xl font-extrabold text-green-600 mt-1" id="faceframe-calculated-cost">$0.00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Global Footer Note (REMOVED) -->
        </div>
    </div>
    <script>
        /**
         * Helper function to convert decimal inches to a mixed fraction string (e.g., 34.9375 -> "34 15/16").
         * Rounds to the nearest specified denominator (default 16th of an inch).
         */
        const decimalToFraction = (decimal, denominator = 16) => {
            if (isNaN(decimal)) return "0";
            // Ensure positive number for fraction calculation
            const absDecimal = Math.abs(decimal); 
            
            const integerPart = Math.floor(absDecimal);
            let fractionalPart = absDecimal - integerPart;
            if (fractionalPart === 0) return decimal.toFixed(2); // Return original if exact integer
            
            let numerator = Math.round(fractionalPart * denominator);
            
            // Handle rounding up to the next inch
            if (numerator === denominator) {
                return (decimal < 0 ? '-' : '') + (integerPart + 1).toString();
            }
            
            const gcd = (a, b) => (b ? gcd(b, a % b) : a);
            const divisor = gcd(numerator, denominator);
            numerator /= divisor;
            denominator /= divisor;
            
            let fractionString = `${numerator}/${denominator}`;
            let sign = decimal < 0 ? '-' : '';

            if (integerPart === 0) {
                // If the original number was negative and near zero (e.g. -0.5), it returns "-1/2"
                // If the original number was positive and near zero (e.g. 0.5), it returns "1/2"
                return sign + fractionString;
            } else {
                return sign + `${integerPart} ${fractionString}`;
            }
        };

        const updateResult = (id, dim1, dim2) => {
            const el = document.getElementById(id);
            if (el) {
                // Ensure dimensions are positive before display (as per woodworking practice)
                const safeDim1 = parseFloat(dim1.toString().replace(/[^0-9\.\/\s-]/g, ''));
                const safeDim2 = parseFloat(dim2.toString().replace(/[^0-9\.\/\s-]/g, ''));

                if (safeDim1 < 0 || safeDim2 < 0) {
                    el.textContent = "Error: Negative Dimension";
                    el.classList.add('text-red-500');
                    el.classList.remove('text-accent', 'text-blue-500', 'text-indigo-500');
                } else {
                    el.textContent = `${dim1}" x ${dim2}"`;
                    // Reset styling to default colors based on the section
                    const defaultColorClass = 
                        id.includes('side') ? 'text-accent' : 
                        id.includes('front-back') ? 'text-blue-500' :
                        id.includes('bottom') ? 'text-indigo-500' : 
                        'text-gray-900';
                    el.classList.remove('text-red-500', 'text-accent', 'text-blue-500', 'text-indigo-500');
                    el.classList.add(defaultColorClass);
                }
            }
        };

        // --- Toggle Function for Collapsible Sections ---
        const toggleSection = (headerId, contentId, iconId) => {
            const content = document.getElementById(contentId);
            const icon = document.getElementById(iconId);
            
            if (content && icon) {
                const isHidden = content.classList.toggle('hidden');
                
                // Rotate the icon 180 degrees when visible
                if (isHidden) {
                    icon.classList.remove('rotate-180');
                } else {
                    icon.classList.add('rotate-180');
                }
            }
        };

        // --- Core Calculation Logic for Euro Cabinet Cut List ---
        const calculateCutList = () => {
            // Get raw input values
            const T_str = document.getElementById('material-thickness').value;
            
            const BoxH_raw = parseFloat(document.getElementById('box-height').value); // A (Cabinet Height)
            const FaceH_raw = parseFloat(document.getElementById('face-height').value); // B (Face/Door Height)
            
            const D_raw = parseFloat(document.getElementById('box-depth').value); // C (Depth)
            const W_raw = parseFloat(document.getElementById('box-width').value); // D (Overall Width)
            const T = parseFloat(T_str); // Thickness: 0.75 or 0.625
            
            // Constants for frameless construction
            const DADO_DEPTH = 0.25; // 1/4" dado depth for recessing the bottom
            const BACK_WIDTH_OFFSET = 0.4375; // 7/16"
            
            if (isNaN(BoxH_raw) || isNaN(FaceH_raw) || isNaN(D_raw) || isNaN(W_raw) || isNaN(T) || BoxH_raw <= 0 || D_raw <= 0 || W_raw <= 0) {
                // Keep the fields at 0.00 if input is invalid
                updateResult('cut-side-dims', '0', '0');
                updateResult('cut-bottom-dims-actual', '0', '0'); 
                updateResult('cut-stretcher-dims', '0', '0'); 
                updateResult('cut-back-dims', '0', '0.00');
                return;
            }
            
            // --- Determine Cabinet Type and Stretcher Count ---
            let stretcher_count = 5; // Default for Door + Drawer
            const selectedConfig = document.querySelector('input[name="cabinet-type"]:checked')?.value;
            
            if (selectedConfig === 'full_door') {
                stretcher_count = 4;
            } else if (selectedConfig === 'drawer_bank') {
                stretcher_count = 6;
            } else {
                // 'door_drawer' or default
                stretcher_count = 5;
            }
            
            // Update Stretcher count label
            const stretcherTitle = document.getElementById('stretcher-count-title');
            if (stretcherTitle) {
                stretcherTitle.textContent = `Stretchers (${stretcher_count}x)`;
            }

            // --- 1. Calculate Final Dimensions ---
            
            // Sides (2x) - Cut: Height x Depth
            const side_height = decimalToFraction(BoxH_raw);
            const side_depth = decimalToFraction(D_raw);
            
            // Common Width for Bottom and Stretchers: (Overall Width - 2T)
            const common_inner_width = W_raw - (2 * T); 
            
            // Bottom Deduction Logic: Cabinet Depth (C) - Material Thickness (T) - Dado Depth
            const bottom_deduction = T + DADO_DEPTH;
            
            // Bottom (1x) - Cut: Width (Fractional) x Depth (Fractional)
            const bottom_width = decimalToFraction(common_inner_width);
            const bottom_depth_raw = D_raw - bottom_deduction;
            const bottom_depth = decimalToFraction(bottom_depth_raw); 
            
            // CALCULATED STRETCHER DEPTH: Cabinet Height (A) - Face Height (B)
            const STRETCHER_DEPTH_RAW = BoxH_raw - FaceH_raw;
            
            // Stretchers (Nx) - Cut: Width (Fractional) x Depth (Fractional)
            const stretcher_width = decimalToFraction(common_inner_width); 
            const stretcher_depth = decimalToFraction(STRETCHER_DEPTH_RAW); 
            
            // Back Panel (1x)
            // Back Panel Width = Bottom/Stretchers Width + 7/16" (0.4375)
            const back_width_decimal = common_inner_width + BACK_WIDTH_OFFSET; 
            const back_height_decimal = FaceH_raw;
            
            // --- 2. Update UI ---
            updateResult('cut-side-dims', side_height, side_depth);
            updateResult('cut-bottom-dims-actual', bottom_width, bottom_depth);
            updateResult('cut-stretcher-dims', stretcher_width, stretcher_depth);
            const back_width_fraction = decimalToFraction(back_width_decimal);
            const back_height_fraction = decimalToFraction(back_height_decimal);
            updateResult('cut-back-dims', back_width_fraction, back_height_fraction);
        };

        // --- Core Calculation Logic for Drawer Box Cut List (NEW FUNCTION) ---
        const calculateDrawerBoxCutList = () => {
            const W_raw = parseFloat(document.getElementById('drawer-box-width').value); // Width
            const D_raw = parseFloat(document.getElementById('drawer-box-depth').value); // Depth (Length)
            const H_raw = parseFloat(document.getElementById('drawer-box-height').value); // Height
            
            const DRAWER_BOTTOM_DEDUCTION = 0.5625; // 9/16"

            // Check if any input is missing or results in non-positive dimensions
            if (isNaN(W_raw) || isNaN(D_raw) || isNaN(H_raw) || W_raw <= 0 || D_raw <= 0 || H_raw <= 0 || W_raw <= DRAWER_BOTTOM_DEDUCTION || D_raw <= DRAWER_BOTTOM_DEDUCTION) {
                // Clear outputs if inputs are invalid or zero/negative or too small
                updateResult('drawer-side-dims', '0', '0');
                updateResult('drawer-front-back-dims', '0', '0');
                updateResult('drawer-bottom-dims', '0', '0');
                return;
            }
            
            // 1. Sides (2x): Depth x Height
            const side_dim1 = decimalToFraction(D_raw);
            const side_dim2 = decimalToFraction(H_raw);
            updateResult('drawer-side-dims', side_dim1, side_dim2);
            
            // 2. Front and Back (2x): (Width - 1") x Height
            const front_back_width_raw = W_raw - 1.0;
            const front_back_dim1 = decimalToFraction(front_back_width_raw);
            const front_back_dim2 = decimalToFraction(H_raw);
            updateResult('drawer-front-back-dims', front_back_dim1, front_back_dim2);

            // 3. 1/4" Bottom (1x): (Width - 9/16") x (Depth - 9/16")
            const bottom_depth_raw = D_raw - DRAWER_BOTTOM_DEDUCTION;
            const bottom_width_raw = W_raw - DRAWER_BOTTOM_DEDUCTION;

            // Width is typically listed first for the bottom panel
            const bottom_dim1 = decimalToFraction(bottom_width_raw); 
            const bottom_dim2 = decimalToFraction(bottom_depth_raw); 
            updateResult('drawer-bottom-dims', bottom_dim1, bottom_dim2);
        };
        
        // --- Calculation Logic for Drawer Rebuild Cost ---
        const calculateDrawerCost = () => {
            const W_raw = parseFloat(document.getElementById('drawer-width').value); // Width
            const D_raw = parseFloat(document.getElementById('drawer-depth').value); // Depth (Length)
            const glidesChecked = document.getElementById('drawer-new-glides').checked; // NEW: Checkbox status
            
            const costEl = document.getElementById('calculated-cost');
            const MAX_COST = 130.00;
            const GLIDES_COST = 25.00; // Updated from $40.00 to $25.00
            
            // Use 0.00 if input is invalid or non-positive
            if (isNaN(W_raw) || W_raw <= 0 || isNaN(D_raw) || D_raw <= 0) {
                // If dimensions are invalid, cost is 0 unless glides are needed
                let initialCost = glidesChecked ? GLIDES_COST : 0.00;
                costEl.textContent = `$${initialCost.toFixed(2)}`;
                return;
            }

            // Formula: Price = (Length + Width) * 3
            const calculatedBaseCost = (W_raw + D_raw) * 3;
            
            // 1. Apply maximum cap of $130.00 to the base rebuild cost
            let finalCost = Math.min(calculatedBaseCost, MAX_COST); 
            
            // 2. Add glides cost after the cap, if checked
            if (glidesChecked) {
                finalCost += GLIDES_COST; 
            }
            
            costEl.textContent = `$${finalCost.toFixed(2)}`;
        };
        
        // Utility function to generate the selector options HTML
        const getDamageOptionHTML = (index) => {
            // Full descriptive text restored for options
            return `
                <div>
                    <label for="damage-level-${index}" class="block text-lg font-medium text-gray-700 mb-1">Section ${index}</label>
                    <select id="damage-level-${index}" 
                            class="faceframe-damage-level-selector block w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent text-base transition duration-150">
                        <option value="touch-up" data-cost="20" selected>Simple touch-up (marker/putty)</option>
                        <!-- UPDATED TEXT HERE -->
                        <option value="small-break" data-cost="50">Small break (epoxy / glue+clamp)</option>
                        <option value="replaced" data-cost="70">Needs replaced</option>
                    </select>
                </div>
            `;
        };
        
        // --- Renders Dynamic Damage Severity Selectors ---
        const renderDamageLevelSelectors = () => {
            const sectionsInput = document.getElementById('faceframe-sections');
            const container = document.getElementById('damage-level-container');
            if (!sectionsInput || !container) return;
            const sections = parseInt(sectionsInput.value);

            // Updated logic: Allow 0 sections, and cap at 10. Default to 0 if input is invalid/empty.
            const numSections = Math.max(0, Math.min(10, sections || 0)); 

            // Wrap selectors in a responsive grid container: 1 column on mobile, 2 columns on sm+ screens
            let html = '<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">';
            for (let i = 1; i <= numSections; i++) {
                html += getDamageOptionHTML(i);
            }
            html += '</div>';
            container.innerHTML = html;
            
            // Attach event listeners to all newly created selects
            document.querySelectorAll('.faceframe-damage-level-selector').forEach(select => {
                select.addEventListener('change', calculateFaceframeCost);
            });
            
            // Re-run calculation after rendering new inputs
            calculateFaceframeCost(); 
        };

        // --- Calculation Logic for Faceframe Repair Cost (Updated) ---
        const calculateFaceframeCost = () => {
            const remade = document.getElementById('faceframe-remade').checked;
            const costEl = document.getElementById('faceframe-calculated-cost');
            const sections = parseInt(document.getElementById('faceframe-sections').value || '0'); // Safely default to 0
            const FLAT_REFINISH_COST = 250.00;
            const MAX_COST = 999.00; 

            // If sections is 0 or less, cost is 0 unless remade is checked
            if (sections <= 0 && !remade) {
                costEl.textContent = "$0.00";
                return;
            }
            
            let totalCost = 0;

            // Priority Logic: If whole faceframe remade is checked, lock the price at $250.00
            if (remade) {
                totalCost = FLAT_REFINISH_COST;
            } else {
                // If not remade, calculate damage cost based on individual sections
                let damageCost = 0;
                
                // 1. Calculate damage cost by summing up all dynamic selectors
                document.querySelectorAll('.faceframe-damage-level-selector').forEach(select => {
                    // Read the cost directly from the data-cost attribute of the selected option
                    const selectedOption = select.options[select.selectedIndex];
                    const sectionCost = parseFloat(selectedOption.getAttribute('data-cost'));
                    if (!isNaN(sectionCost)) {
                        damageCost += sectionCost;
                    }
                });
                
                totalCost = damageCost;
            }
            
            // Apply mock max cap (helpful if non-remade damage cost is extremely high)
            if (totalCost > MAX_COST) {
                totalCost = MAX_COST;
            }
            costEl.textContent = `$${totalCost.toFixed(2)}`;
        };
        
        // --- Event Listener Setup ---
        const cutListInputs = [
            'material-thickness', 'box-height', 'face-height', 'box-depth', 'box-width',
            'config-door-drawer', 'config-full-door', 'config-drawer-bank' 
        ];
        
        const drawerBoxCutListInputs = [
            'drawer-box-width', 'drawer-box-depth', 'drawer-box-height'
        ];
        
        const drawerCostInputs = [
            'drawer-width', 
            'drawer-depth',
            'drawer-new-glides' // NEW INPUT
        ];
        
        // Add listeners to cut list inputs
        cutListInputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', calculateCutList);
                el.addEventListener('change', calculateCutList); // for select and radio changes
            }
        });

        // Add listeners to NEW Drawer Box Cut List inputs
        drawerBoxCutListInputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', calculateDrawerBoxCutList);
                el.addEventListener('change', calculateDrawerBoxCutList);
            }
        });
        
        // Add listeners to drawer cost inputs (checking element type for better event handling)
        drawerCostInputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                // Use 'change' for checkbox/select elements, and 'input' for text/number fields
                const eventType = (el.type === 'checkbox' || el.tagName === 'SELECT') ? 'change' : 'input';
                el.addEventListener(eventType, calculateDrawerCost);
            }
        });
        
        // Faceframe Repair Listeners
        const faceframeSectionInput = document.getElementById('faceframe-sections');
        const faceframeRemadeCheckbox = document.getElementById('faceframe-remade');

        if (faceframeSectionInput) {
            // When the number of sections changes, re-render the selectors and recalculate
            faceframeSectionInput.addEventListener('input', renderDamageLevelSelectors);
        }
        
        if (faceframeRemadeCheckbox) {
            // When the checkbox changes, just recalculate
            faceframeRemadeCheckbox.addEventListener('change', calculateFaceframeCost);
        }

        // --- Mobile Menu Toggle Logic & Initial Calc ---
        document.addEventListener('DOMContentLoaded', () => {
            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            if (button && menu) {
                button.addEventListener('click', () => {
                    menu.classList.toggle('hidden');
                    document.body.classList.toggle('overflow-hidden');
                });
            }
            
            // --- Toggle Listeners ---
            document.getElementById('cut-list-header')?.addEventListener('click', () => {
                toggleSection('cut-list-header', 'cut-list-content', 'cut-list-icon');
            });
            // NEW DRAWER BOX CUT LIST TOGGLE
            document.getElementById('drawer-box-cut-list-header')?.addEventListener('click', () => {
                toggleSection('drawer-box-cut-list-header', 'drawer-box-cut-list-content', 'drawer-box-cut-list-icon');
            });
            document.getElementById('drawer-cost-header')?.addEventListener('click', () => {
                toggleSection('drawer-cost-header', 'drawer-cost-content', 'drawer-cost-icon');
            });
            // New Faceframe Repair Toggle Listener
            document.getElementById('faceframe-repair-header')?.addEventListener('click', () => {
                toggleSection('faceframe-repair-header', 'faceframe-repair-content', 'faceframe-repair-icon');
            });

            // Initial calculation to populate fields on load
            calculateCutList();
            calculateDrawerBoxCutList(); // Call the new calculation function
            calculateDrawerCost();
            renderDamageLevelSelectors(); 
        });
    </script>
</body>
</html>
